# Environment Setup Guide

## 1. Spotify App Setup

1. Go to [Spotify Developer Dashboard](https://developer.spotify.com/dashboard)
2. Click "Create App"
3. Fill in:
   - App name: AI Muzak
   - App description: AI-powered emotional playlist generator
   - Redirect URI: `http://127.0.0.1:3000/api/auth/spotify/callback`
   - Select "Web API" 
4. Save your Client ID and Client Secret

**Required Scopes:**
- user-read-private
- user-read-email
- user-top-read
- user-read-recently-played
- playlist-modify-public
- playlist-modify-private
- streaming
- user-library-read

## 2. Firebase Setup

1. Go to [Firebase Console](https://console.firebase.google.com)
2. Create a new project: "ai-muzak"
3. Enable:
   - Authentication (with Email/Password provider)
   - Firestore Database (start in test mode)
   - Storage (optional, for playlist images)

### Firestore Security Rules
```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Users can only read/write their own data
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Users can only read/write their own playlists
    match /playlists/{playlistId} {
      allow read: if request.auth != null && 
        (resource.data.userId == request.auth.uid || resource.data.isPublic == true);
      allow create: if request.auth != null && 
        request.resource.data.userId == request.auth.uid;
      allow update, delete: if request.auth != null && 
        resource.data.userId == request.auth.uid;
    }
  }
}
```

### Get Firebase Admin SDK Key
1. Project Settings > Service Accounts
2. Generate New Private Key
3. Copy the values to your .env.local

## 3. OpenAI Setup

1. Go to [OpenAI Platform](https://platform.openai.com)
2. Create an API key
3. Add to .env.local

## 4. NextAuth Setup

Your `NEXTAUTH_SECRET` is already generated by the setup script. If you need a new one:
```bash
openssl rand -base64 32
```

## 5. Local Development

```bash
# Install dependencies
npm install

# Run development server
npm run dev
```

Visit http://127.0.0.1:3000

## 6. Production Deployment (Vercel)

1. Push to GitHub
2. Import to Vercel
3. Add all environment variables
4. Update Spotify redirect URI to: `https://your-app.vercel.app/api/auth/spotify/callback`
5. Update `NEXTAUTH_URL` to your production URL

## Common Issues

### Spotify "Invalid Client" Error
- Double-check Client ID and Secret
- Ensure redirect URI matches exactly (including trailing slashes)

### Firebase Permission Denied
- Check security rules
- Ensure user is authenticated
- Verify Firebase Admin SDK credentials

### OpenAI Rate Limits
- Use GPT-3.5-turbo for cost efficiency
- Implement caching for similar prompts
- Add retry logic with exponential backoff

### Playback SDK Not Working
- Requires Spotify Premium account
- Must be using HTTPS in production
- Check browser console for errors

## Support Resources

- [Next.js Docs](https://nextjs.org/docs)
- [Firebase Docs](https://firebase.google.com/docs)
- [Spotify Web API](https://developer.spotify.com/documentation/web-api)
- [OpenAI Docs](https://platform.openai.com/docs)
